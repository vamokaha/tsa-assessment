stages:
  - deploy

variables:
  DEPLOY_DIR: "/var/www/html"

deploy_wordpress:
  stage: deploy
  image: alpine:latest
  before_script:
    - apk update && apk add git wget tar bash
  script:
    # Clone your GitLab repo
    - git clone https://gitlab.com/vamokaha2-group/tsa-assessment.git site-code
    - cd site-code

    # Download latest WordPress package
    - wget https://wordpress.org/latest.tar.gz
    - tar -xvzf latest.tar.gz
    - mv wordpress/* $DEPLOY_DIR/
    - rm -rf wordpress latest.tar.gz

    # Copy custom repo files
    - cp -r * $DEPLOY_DIR/

    # Set directory/file permissions
    - chmod -R 755 $DEPLOY_DIR
    - chown -R www-data:www-data $DEPLOY_DIR
  only:
    - main

